{% extends "layouts/base-fullscreen.html" %}
{% block title %} Azure {% endblock %} 
<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}
<link type="text/css" href="/static/assets/css/pixel.css" rel="stylesheet">
<link type="text/css" href="/static/assets/vendor/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link type="text/css" href="/static/assets/css/report.css" rel="stylesheet">
<link type="text/css" href="/static/assets/css/nfrs.css" rel="stylesheet">
{% endblock stylesheets %}
{% block content %}
    <main>
        <div class="main-background">
            {% include 'includes/sidebar.html' %}
            <div class="main-body">
                <div class="justify-content-start main-body_header" style="background-color: rgba(0, 0, 0, 0.2); height: 4rem;">
                    <a class="text-white footer-logo-text">NFRs</a>
                </div> 
                <div class="nfrs-container" id="nfrs-accordion">
                    {% for nfrsItem in nfrsList %}
                    <div class="nfrs-item">
                        <h2 class="nfrs-header" id="heading_{{ nfrsItem.appName }}">
                            <button class="nfrs-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#{{ nfrsItem.appName }}" aria-expanded="false" aria-controls="{{ nfrsItem.appName }}">
                                <div style="font-size: 1rem;padding-right: 0.5rem;color: darkgrey;">App name:</div>{{ nfrsItem.appName }}
                                <div style="font-size: 1rem;padding-left: 2rem; color: darkgrey;">Number of NFRs:</div>
                                <div class="nfr-circle" style="display:block;" id="{{ nfrsItem.appName }}"></div>
                                <div></div>
                            </button>
                        </h2>
                        <div id="{{ nfrsItem.appName }}" class="accordion-collapse collapse" aria-labelledby="heading_{{ nfrsItem.appName }}" data-bs-parent="#nfrs-accordion">
                            <div class="nfrs-body">
                                <div class="nfrs-body-header">
                                    <a class="btn nfr-action-btn" href="/nfr?appName={{ nfrsItem.appName }}" role="button">Edit</a>
                                    <a class="btn nfr-action-btn" href="#" role="button">Delete</a>
                                </div>
                                <div class="nfr-table-wraper">
                                    <div class="nfr-table">
                                        <div class="nfr-table-header">Scope</div>
                                        <div class="nfr-table-header">Metric</div>
                                        <div class="nfr-table-header">Aggregation</div>
                                        <div class="nfr-table-header">Operation</div>
                                        <div class="nfr-table-header">Threshold</div>
                                        <div class="nfr-table-header">Weight</div>
                                    </div>
                                    <div class="nfr-table">
                                        {% for nfr in nfrsItem.rows %}
                                            <div class="nfr-table-column">{{ nfr.scope }}</div>
                                            <div class="nfr-table-column">
                                                <div>
                                                    <span class="nfr-metric-name">{{ nfr.metric }}</span>
                                                </div>
                                            </div>
                                            <div class="nfr-table-column">{{ nfr.aggregation }}</div>
                                            <div class="nfr-table-column">{{ nfr.operation }}</div>
                                            <div class="nfr-table-column">{{ nfr.threshold }}</div>
                                            <div class="nfr-table-column">{{ nfr.weight }}</div>
                                        {% endfor %} 
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %} 
                </div>
                <div class="nfrs-panel" style="padding-left: 2rem;">
                    <a class="btn nfr-btn" href="/nfr" role="button">Create new</a>
                </div>
            </div>
        </div>
        <script>
            var nfrsJson = JSON.parse('{{ nfrsList | tojson }}');
            var nfrsPanel = document.getElementById("nfrs-panel");
            if(nfrsJson["status"] != null){
                if(nfrsJson["status"] == "error"){
                    if(nfrsPanel.querySelector('.status-message') != null){
                        nfrsPanel.querySelector('.status-message').remove();
                    }
                    let elem = '<div class="bad-msg status-message">'+nfrsJson["message"]+'</div>';
                    nfrsPanel.insertAdjacentHTML("beforeend", elem);
                }
            }
            for(var i = 0; i < nfrsJson.length; i++) {
                if(nfrsJson[i]["appName"] != null){
                    var elem = document.getElementById(nfrsJson[i]["appName"]);
                    elem.textContent = nfrsJson[i]["rows"].length;
                }
            }
        </script>
    </main>
    {% include 'includes/footer.html' %}
{% endblock content %}